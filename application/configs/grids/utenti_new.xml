<?xml version="1.0" encoding="UTF-8"?>
<grids>
    <utenti_new>
        <title>Utenti</title>
        <addlink>/new-users/new</addlink>
        <addtitle>Nuovo utente</addtitle>
        <parameters>
            <baseUrl>
                <from>defaultnamespace</from>
            </baseUrl>
            <aclReadonly>
                <from>defaultnamespace</from>
            </aclReadonly>
            <canDelete>
                <from>cond</from>
                <type>eq</type>
                <op1>{{aclReadonly}}</op1>
                <op2>1</op2>
            </canDelete>
        </parameters>
        <select>
            <from>
                <aliasname>
                    <utenti>utenti</utenti>
                </aliasname>
                <fields>
                    <id_utente>id_utente</id_utente>
                    <nome>nome</nome>
                    <cognome>cognome</cognome>
                    <interno>interno</interno>
                    <cellulare>cellulare</cellulare>
                    <email>email</email>
                    <id_userlevel>id_userlevel</id_userlevel>
                    <note>note</note>
                </fields>
            </from>
            <join id='tab_userlevel'>
                <cond>tab_userlevel.id_userlevel = utenti.id_userlevel</cond>
                <aliasname>
                    <tab_userlevel>tab_userlevel</tab_userlevel>
                </aliasname>
                <fields>
                    <Tipo>Titolo</Tipo>
                </fields>
            </join>
            <join id='login'>
                <type>left</type>
                <cond>login.id_utente = utenti.id_utente</cond>
                <aliasname>
                    <login>login</login>
                </aliasname>
                <fields>
                    <id_login>login.id</id_login>
                    <Username>GROUP_CONCAT(login.username SEPARATOR ", ")</Username>
                </fields>
            </join>
            <group>
                utenti.id_utente
            </group>
            <order>CONCAT(utenti.cognome, utenti.nome)</order>            
        </select>
        <updatecolumns>
            <id_utente>
                <hidden>1</hidden>
            </id_utente>
            <id_userlevel>
                <hidden>1</hidden>
            </id_userlevel>
            <id_login>
                <hidden>1</hidden>                
            </id_login>
            <nome>
                <position>1</position>
                <title>Nome</title>
            </nome>
            <cognome>
                <position>2</position>
                <title>Cognome</title>
            </cognome>
            <interno>
                <position>3</position>
                <title>Interno</title>
            </interno>
            <email>
                <position>4</position>
                <title>Email</title>
            </email>
            <cellulare>
                <position>5</position>
                <title>Cellulare</title>                
            </cellulare>
            <note>
                <position>6</position>
                <title>Note</title>
                note
            </note>
            <Tipo>
                <position>7</position>
                <title>Titolo</title>                
            </Tipo>
            <Username>
                <position>8</position>
                <title>Username</title>
            </Username>
        </updatecolumns>
        <extracolumns>
            <Edit>
                <position>left</position>
                <title>Edit</title>
                <decorator>
                    /new-users/edit/id/{{id_utente}}#/images/edit.png#Edit
                </decorator>
            </Edit>
            <Password>
                <position>left</position>
                <title>Password</title>
                <decorator>
                    /new-users/edit-password/idutente/{{id_utente}}/idlogin/{{id_login}}#/images/ico-avvio-2.png#Password
                </decorator>
            </Password>
            <if>
                <cond>{{canDelete}}</cond>
                <iftrue>
                </iftrue>
                <iffalse>                    
                    <Del>
                        <position>left</position>
                        <title>Delete</title>
                        <decorator>
                            <link>
                                    /new-users/delete/id/{{id_utente}}
                            </link>
                            <linkstyle>
                                    cursor:help;
                            </linkstyle>
                            <linkimg>
                                    /images/fechar.png
                            </linkimg>
                            <onclick>return(confirm('Confirm delete?'));</onclick>
                            <linkalt>
                                    Delete
                            </linkalt>
                            <linktitle>
                                    Delete
                            </linktitle>                    
                        </decorator>
                    </Del>
                </iffalse>
            </if>
        </extracolumns>
    </utenti_new>
</grids>