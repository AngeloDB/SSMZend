<?xml version="1.0" encoding="UTF-8"?>
<grids>
    <eventi>
        <title>Eventi</title>
        <addlink>/eventi/new</addlink>
        <addtitle>Nuovo evento</addtitle>
        <parameters>
            <currIdProgetto>
                <from>arrdefaultnamespace</from>
                <array>currProject</array>
                <offset>idProgetto</offset>
            </currIdProgetto>
            <aclReadonly>
                <from>defaultnamespace</from>
            </aclReadonly>
            <canDelete>
                <from>cond</from>
                <type>eq</type>
                <op1>{{aclReadonly}}</op1>
                <op2>1</op2>
            </canDelete>
        </parameters>
        <select>
            <from>
                <aliasname>
                    <eventi>eventi</eventi>
                </aliasname>
                <fields>
                    <idEvento>idEvento</idEvento>
                    <Evento>Evento</Evento>
                    <Data>Data</Data>
                    <Note>Note</Note>
                </fields>
            </from>
            <join id='progetti'>
                <cond> progetti.idProgetto = eventi.idProgetto</cond>
                <aliasname>
                    <progetti>progetti</progetti>
                </aliasname>
                <fields>
                    <Commessa>Nome</Commessa>
                </fields>
            </join>
            <join>
            </join>
            <where>
                <from>
                    eventi.idProgetto = "{{currIdProgetto}}"                    
                </from>
            </where>
        </select>
        <updatecolumns>
            <idEvento>
                <hidden>1</hidden>
            </idEvento>
            <Commessa>
                <title>Commessa</title>
                <position>1</position>
            </Commessa>
            <Evento>
                <title>Evento</title>
                <position>2</position>
            </Evento>
            <Data>
                <title>Data</title>
                <position>3</position>
                <format>date</format>
<!--                <format>
                    <locale>it-IT</locale>
                    <date_format>dd/MM/y</date_format>
                </format>-->
            </Data>
            <Note>
                <title>Note</title>
                <position>4</position>
            </Note>
        </updatecolumns>
        <updateCallbacks>
            <Data>
                <class>Custom_GridCallback</class>
                <method>format_date</method>
                <params>{{Data}}</params>
            </Data>
            <End></End>
        </updateCallbacks>  
        <extracolumns>
            <Edit>
                <position>left</position>
                <title></title>
                <decorator>
                    /eventi/edit/id/{{idEvento}}#/images/edit.png#Edit
                </decorator>
            </Edit>
            <if>
                <cond>{{canDelete}}</cond>
                <iftrue>
                </iftrue>
                <iffalse>                    
                    <Del>
                        <position>left</position>
                        <title>Delete</title>
                        <decorator>
                            <link>/eventi/delete/id/{{idEvento}}</link>
                            <linkstyle>cursor:help;</linkstyle>
                            <linkimg>/images/fechar.png</linkimg>
                            <onclick>return(confirm('Confirm delete?'));</onclick>
                            <linkalt>Delete</linkalt>
                            <linktitle>Delete</linktitle>                    
                        </decorator>
                    </Del>
                </iffalse>
            </if>
        </extracolumns>
    </eventi>
</grids>